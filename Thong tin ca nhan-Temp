Feature: Cấu hình thông tin cá nhân, hộ kinh doanh, cá nhân kinh doanh
  
  Là một Kế toán
  Tôi muốn cấu hình các trường thông tin cá nhân hiển thị trên chứng từ
  Để thu thập đúng thông tin cần thiết theo quy định pháp lý

  Background: Người dùng đang cấu hình thông tin cá nhân
    Given Người dùng đã chọn mẫu chứng từ
    And Người dùng đang ở trang "Chỉnh sửa mẫu"
    And Tab "Nội dung hóa đơn" đang được chọn
    And Section "Thông tin cá nhân, hộ kinh doanh, cá nhân kinh doanh" đang mở

  # ============================================================
  # PHẦN 1: HIỂN THỊ MẶC ĐỊNH - TRƯỜNG BẮT BUỘC VÀ TÙY CHỌN
  # ============================================================

  Scenario: Hiển thị các trường thông tin cá nhân mặc định
    When Section được tải lên
    Then Hệ thống hiển thị 8 trường thông tin
    And 4 trường BẮT BUỘC được đánh dấu chọn và không thể tắt:
      | Trường            | Bắt buộc | Checkbox |              Ghi chú                                    |
      | Họ và tên         | Có       | Checked & Disabled | Bắt buộc                                      |
      | Mã số thuế        | Có       | Checked & Disabled | Bắt buộc (Nếu có)                             |
      | Địa chỉ           | Có       | Checked & Disabled | Bắt buộc                                      |
      | Cá nhân cư trú    | Có       | Checked & Disabled | Bắt buộc (Nếu có) - Có/Không                  |

    And 4 trường TÙY CHỌN không được chọn mặc định:
      | Trường                | Bắt buộc | Checkbox | Ghi chú                                           |
      | Quốc tịch             | Không    | Unchecked | Nếu người nộp thuế không phải quốc tịch Việt Nam |
      | CCCD/HC               | Không    | Unchecked | Nếu không có MST thì require trường này          |
      | Địa chỉ thư điện tử   | Không    | Unchecked | Không bắt buộc                                   |
      | Ghi chú               | Không    | Unchecked | Nếu mẫu có thông tin cần in lên trường này       |

  # ============================================================
  # PHẦN 2: TRƯỜNG BẮT BUỘC - KHÔNG THỂ TẮT
  # ============================================================

  @required-fields @validation
  Scenario: Không thể tắt các trường bắt buộc
    Given 4 trường bắt buộc đang được checked và disabled
    When Người dùng cố gắng click vào checkbox của bất kỳ trường bắt buộc nào
    Then Checkbox vẫn ở trạng thái checked
    And Không có thay đổi nào xảy ra
    And Trường vẫn hiển thị trong preview

  # ============================================================
  # PHẦN 3: TRƯỜNG "CÁ NHÂN CƯ TRÚ" - DROPDOWN BẮT BUỘC
  # ============================================================

  @required-fields @resident-status
  Scenario: Trường "Cá nhân cư trú" luôn hiển thị với dropdown
    Given Trường "Cá nhân cư trú" là trường bắt buộc
    When Section được tải lên
    Then Checkbox "Cá nhân cư trú" đã checked và disabled
    And Dropdown "Cá nhân cư trú" hiển thị với 2 options:
      | Option value | Option text            |
      | "Có"         | Có                     |
      | "Không"      | Không                  |

  @resident-status
  Scenario: Chọn giá trị "Có" cho cá nhân cư trú
    Given Dropdown "Cá nhân cư trú" đang ở giá trị mặc định
    When Người dùng chọn "Có" từ dropdown
    Then Dropdown hiển thị giá trị "Có"
    And Preview cập nhật hiển thị "Cá nhân cư trú: Có"

  @resident-status
  Scenario: Chọn giá trị "Không" cho cá nhân cư trú
    Given Dropdown "Cá nhân cư trú" đang ở giá trị mặc định
    When Người dùng chọn "Không" từ dropdown
    Then Dropdown hiển thị giá trị "Không"
    And Preview cập nhật hiển thị "Cá nhân cư trú: Không"

  # ============================================================
  # PHẦN 4: TRƯỜNG TÙY CHỌN - CÓ THỂ BẬT/TẮT
  # ============================================================

  @optional-fields @toggle
  Scenario: Bật hiển thị trường tùy chọn "Quốc tịch"
    Given Trường "Quốc tịch" đang bị ẩn
    And Checkbox "Quốc tịch" không được check
    When Người dùng đánh dấu chọn checkbox "Quốc tịch"
    Then Preview hiển thị trường "Quốc tịch" với giá trị trống

  @optional-fields @toggle
  Scenario: Tắt trường tùy chọn "Địa chỉ thư điện tử"
    Given Trường "Địa chỉ thư điện tử" đang được hiển thị
    And Checkbox "Địa chỉ thư điện tử" đã được check
    When Người dùng bỏ chọn checkbox "Địa chỉ thư điện tử"
    Then Trường "Địa chỉ thư điện tử" biến mất khỏi preview
    And Checkbox chuyển sang unchecked

  @optional-fields @toggle
  Scenario: Bật trường "Ghi chú"
    Given Trường "Ghi chú" đang bị ẩn
    When Người dùng đánh dấu chọn "Ghi chú"
    Then Preview hiển thị trường "Ghi chú"
